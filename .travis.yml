sudo: required

# Only build if there's no tag, but manually set the 'continuous' tag for deploy
if: tag IS blank
env: 
  - TRAVIS_TAG=continuous

matrix:
  include:
    - env: ARCH=armhf TRAVIS_TAG=continuous
    - env: ARCH=arm64 TRAVIS_TAG=continuous
    - env: ARCH=amd64 TRAVIS_TAG=continuous
    - env: ARCH=i386 TRAVIS_TAG=continuous

install:
  - echo "deb http://de.archive.ubuntu.com/ubuntu xenial main universe" |sudo tee -a /etc/apt/sources.list
  - sudo apt-get update
  - sudo apt-get install dpkg qemu-user-static debootstrap -y

script:
  - sudo ./build-initrd.sh

before_cache:
  - sudo chown -R travis build/

cache:
  directories:
    - build/

before_deploy:
    # Set up git user name and tag this commit
  - git config --local user.name "JBBgameich"
  - git config --local user.email "JBBgameich@users.noreply.github.com"
  - git tag -fa "continuous" -m "Generated by Travis-CI"

deploy:
  skip_cleanup: true
  provider: releases
  api_key:
    secure: AKHBWjEqKenes6UN2x3Dtq145tPfkeq4k5nxDW2BdPFB7gTnc180iQX3Qnjf8SO1csWh6Ir3+Wl86HuBxkvI+x/KLL/TGQdDDveza3bD57y8eD+i8gW2Ivny/DQJ2EWfoYP6Of4S6Pm2aIPYY2NLJIYCYahgBGhYh2Ek7GNuTQC1rQrCG5p8QGt3tD64vvo9I9BsJJ44UL5VK2lCL4dEngoFpj4d6Rh+DX9sGEEnwTqRSaLRdx7tAYkcPVQ8uKNHvnzCEIHFZdbQiMF4kl5x8b1NZpOm9N4Uc3haIWRdX0IIt8r+whwEA2yNEOasLquoBRu1v6jtUPkMBqhd1nn9keINmFGGDtEif9s0kkysjknrTgLuPEAmRVvhLFdq41JTyHfaSZs23ScjSLDrfeeJC9hhdsRg38XGW5KIhxh8nHa3UAgVnvlh7Zq/tIyLJ2ZWMZ5UUQtZUY8iKBcG1+fAKuNVFQLp79WNWA1ez8E1Pgscak2qoYCCDwlW9Cbwl/t8SbmMuOhxw6y6A3IBBSRVZfHd8w2SYv2f0vLCNL3a6HTyFTXuPeN+k+WL2zmSgaEn6VmCngTjkaj9flMTyXDYyMYqRxloIwPYVmCaxcf9UNZWiVt+EMuVvXDfLoMvrs7H6rg12jx5pu3K++u5E5p34VK/F6qB6iubSBNzDoygrmY=
  file: 
    - out/initrd.img-generic-armhf
    - out/initrd.img-generic-arm64
    - out/initrd.img-generic-amd64
    - out/initrd.img-generic-i386
  on:
    repo: debian-pm-tools/generic-initrd
    branch: master
  overwrite: true
